# nano-os

Простая экспериментальная операционная система, написанная с нуля на C и ассемблере для архитектуры x86.

## Особенности

*   **Загрузка:** Использует GRUB в качестве загрузчика (Multiboot).
*   **Ядро:** Написано на C и ассемблере (NASM), компилируется с флагами `-ffreestanding`, `-nostdlib`.
*   **Архитектура:** Поддержка x86 (i386), 32-бит.
*   **Память:**
    *   Управление памятью: простая куча (`kmalloc`, `kcalloc`, `kfree`), реализованная как bump allocator.
    *   Страницы: базовая реализация.paging (идентичное отображение первых 16 МБ физической памяти).
*   **Ввод/вывод:**
    *   Видео: VGA-совместимый текстовый режим (TTY) с поддержкой цвета и программного курсора.
    *   Клавиатура: Драйвер клавиатуры (PS/2), обработка scancode set 1, поддержка модификаторов (Shift, Caps Lock) и некоторых специальных клавиш (стрелки, Enter, Backspace).
*   **Прерывания:**
    *   GDT (Global Descriptor Table): Инициализация и перезагрузка сегментов.
    *   IDT (Interrupt Descriptor Table): Инициализация, обработчики исключений (ISRs) и прерываний (IRQs).
    *   PIC (8259A): Инициализация и ремапинг, чтобы избежать конфликта с исключениями CPU.
    *   Системные вызовы: Простая таблица системных вызовов, вызываемая через `int 0x80`.
*   **Файловая система:** Простая RAMFS, реализующая базовый VFS-интерфейс. Файлы хранятся в памяти, инициализируются при запуске.
*   **Планировщик задач:** Базовый планировщик, реализующий кольцевое переключение между потоками (cooperative multitasking).
*   **Таймер:** PIT (8253/8254) используется для генерации периодических прерываний (примерно 100 Гц) для подсчёта тиков и планировщика.
*   **Пользовательский интерфейс:** Интерактивный командный интерпретатор (shell) с поддержкой:
    *   Истории команд (стрелки вверх/вниз).
    *   Базового автодополнения (Tab для команд).
    *   Навигации и редактирования строки (стрелки, Home, End, Backspace, Delete).
    *   Набора базовых команд (`help`, `dir`/`ls`, `type`, `copy`, `del`, `ren`, `echo`, `cls`, `mem`, `ver`, `ticks`, `halt`).

## Сборка и запуск

### Требования

*   `gcc` (i686-w64-mingw32-gcc для кросс-компиляции, если не используется хост x86_64 Linux)
*   `nasm` (Netwide Assembler)
*   `ld` (GNU Linker)
*   `grub-mkrescue`
*   `xorriso`
*   `qemu-system-x86_64` (для запуска в эмуляторе)

> **Примечание:** На Linux обычно все необходимые инструменты доступны из репозитория. На Windows может потребоваться кросс-инструментарий, например, MinGW-w64 или WSL.

### Компиляция и запуск

1.  Клонируйте репозиторий (или разместите код в папке).
2.  Откройте терминал/командную строку в папке с проектом.
3.  Выполните `make run`:

    ```bash
    make run
    ```

    Это выполнит следующие действия:
    *   Компиляция всех `.c`, `.asm`, `.s` файлов.
    *   Компоновка исполняемого файла `kernel.elf`.
    *   Создание ISO-образа `iso/nano-os.iso` с помощью `grub-mkrescue`.
    *   Запуск образа в `qemu-system-x86_64`.

> **Примечание:** В Makefile таймаут GRUB установлен в 0 секунд (`set timeout=0` в `grub.cfg`), поэтому загрузка начнётся сразу.

## Структура проекта

*   `boot/`: Файл `multiboot.s` - точка входа и заголовки Multiboot.
*   `fs/`: Код файловой системы (`ramfs.c`, `vfs.c`, `initramfs.c`).
*   `kernel/`: Основной код ядра (GDT, IDT, прерывания, куча, клавиатура, PIT, планировщик, VGA, системные вызовы, `kmain.c`).
*   `user/`: Простые демонстрационные "пользовательские" программы.
*   `Makefile`: Скрипт сборки.
*   `linker.ld`: Линкерный скрипт.
*   `grub.cfg`: Конфигурация GRUB.

## Возможности для развития

*   Добавление поддержки пользовательского режима (CPL=3) и переключения между пространствами.
*   Реализация более сложного планировщика (вытесняющий, на основе приоритетов).
*   Поддержка виртуальной памяти для процессов.
*   Реализация файловой системы на диске (например, простой FAT).
*   Добавление поддержки ELF-лоадера для загрузки исполняемых файлов из файловой системы.
*   Улучшение системных вызовов и добавление поддержки большего количества функций.
*   Добавление драйверов для других устройств (например, ATA/IDE для дисков).
*   Улучшение обработки ошибок и стабильности.

## Лицензия

Пока не указана.